---
#  ansible-playbook droplets.yml -i inventory-marvel-dyninv --extra-vars "app_name=latveria"

avenger_servers:
  latveria:
    name: "latveria"
    region: "us-east-1"
    state: present
    default_visibility_timeout: 30
    message_retention_period: 345600
    maximum_message_size: 262144
    delivery_delay: 0
    receive_message_wait_time: 20
  avengers-tower:
    name: "avengers-tower"
    region: "us-east-1"
    state: present
    default_visibility_timeout: 30
    message_retention_period: 345600
    maximum_message_size: 262144
    delivery_delay: 0
    receive_message_wait_time: 20
  baxter:
    name: "baxter"
    region: "us-east-1"
    state: present
    default_visibility_timeout: 30
    message_retention_period: 345600
    maximum_message_size: 262144
    delivery_delay: 0
    receive_message_wait_time: 20




# # digitalocean docker-swarm


# --digitalocean-access-token	DIGITALOCEAN_ACCESS_TOKEN	-
# --digitalocean-image	DIGITALOCEAN_IMAGE	ubuntu-16-04-x64
# --digitalocean-region	DIGITALOCEAN_REGION	nyc3
# --digitalocean-size	DIGITALOCEAN_SIZE	512mb
# --digitalocean-ipv6	DIGITALOCEAN_IPV6	false
# --digitalocean-private-networking	DIGITALOCEAN_PRIVATE_NETWORKING	false
# --digitalocean-backups	DIGITALOCEAN_BACKUPS	false
# --digitalocean-userdata	DIGITALOCEAN_USERDATA	-
# --digitalocean-ssh-user	DIGITALOCEAN_SSH_USER	root
# --digitalocean-ssh-port	DIGITALOCEAN_SSH_PORT	22
# --digitalocean-ssh-key-fingerprint	DIGITALOCEAN_SSH_KEY_FINGERPRINT	-
# --digitalocean-tags	DIGITALOCEAN_TAGS



# earth
# planethulk
# asgard
# attilan
# atlantis


# stark-tower
# attilan
# latvaria



# stark-tower
# necropolis
# baxter
# latveria


# # source: https://docs.gitlab.com/ce/install/digitaloceandocker.html

# docker-machine create stark-tower \
#   -d digitalocean \
#   --digitalocean-access-token XXX-XXX \
#   --digitalocean-region \
#   --digitalocean-size "4gb" \
#   --digitalocean-image fedora-25-x64-atomic


# doctl compute tag create role:marvel-swarm-manager && \
# doctl compute tag create role:marvel-swarm-agent && \
# doctl compute tag create name:stark-tower && \
# doctl compute tag create name:necropolis && \
# doctl compute tag create name:baxter && \
# doctl compute tag create name:latveria && \
# doctl compute tag create region:nyc3 && \
# doctl compute tag create cluster:swarm-marvel


# doctl compute droplet tag stark-tower --tag-name 'role:marvel-swarm-manager' && \
# doctl compute droplet tag stark-tower --tag-name 'name:stark-tower' && \
# doctl compute droplet tag stark-tower --tag-name 'region:nyc3' && \
# doctl compute droplet tag stark-tower --tag-name 'cluster:swarm-marvel' \

# && \

# doctl compute droplet tag baxter --tag-name 'role:marvel-swarm-agent' && \
# doctl compute droplet tag baxter --tag-name 'name:baxter' && \
# doctl compute droplet tag baxter --tag-name 'region:nyc3' && \
# doctl compute droplet tag baxter --tag-name 'cluster:swarm-marvel' \

# && \

# doctl compute droplet tag latveria --tag-name 'role:marvel-swarm-agent' && \
# doctl compute droplet tag latveria --tag-name 'name:latveria' && \
# doctl compute droplet tag latveria --tag-name 'region:nyc3' && \
# doctl compute droplet tag latveria --tag-name 'cluster:swarm-marvel' && \

# doctl compute droplet tag latveria --tag-name 'name:homelab_ip_cidr'

# doctl compute firewall create \
#   add-rules \
#   --droplet-ids '66766275,66766364,66766499' \
#   --name "marvel-swarm-rules" \
#   --inbound-rules 'protocol:tcp,ports:22,address:192.147.118.253/32 protocol:tcp,ports:22,address:196.52.34.22/32 protocol:tcp,ports:22,address:69.203.219.29/32' \
#   --outbound-rules 'protocol:icmp,ports:all,address:0.0.0.0/0,address:::/0 protocol:tcp,ports:all,address:0.0.0.0/0,address:::/0 protocol:udp,ports:all,address:0.0.0.0/0,address:::/0' \
#   --tag-names 'cluster:swarm-marvel,name:marvel-swarm-rules'

# doctl compute firewall create \
#   add-rules \
#   --name "marvel-swarm-rules" \
#   --inbound-rules 'protocol:tcp,ports:22,address:192.147.118.253/32 protocol:tcp,ports:22,address:196.52.34.22/32 protocol:tcp,ports:22,address:69.203.219.29/32' \
#   --outbound-rules 'protocol:icmp,address:0.0.0.0/0,address:::/0 protocol:tcp,ports:all,address:0.0.0.0/0,address:::/0 protocol:udp,ports:all,address:0.0.0.0/0,address:::/0' \
#   --tag-names 'cluster:swarm-marvel,name:marvel-swarm-rules'

# # this works
# doctl compute firewall create \
#   --name marvel-swarm-rules \
#   --tag-names 'cluster:swarm-marvel' \
#   --inbound-rules "protocol:tcp,ports:22,address:192.147.118.253/32"


# # try this (038ccf60-c31d-40ed-83b3-0201b22d1227)
# doctl compute firewall update 038ccf60-c31d-40ed-83b3-0201b22d1227 \
#   --name marvel-swarm-rules \
#   --tag-names 'cluster:swarm-marvel' \
#   --inbound-rules 'protocol:tcp,ports:22,address:192.147.118.253/32 protocol:tcp,ports:22,address:196.52.34.22/32 protocol:tcp,ports:22,address:69.203.219.29/32' \
#   --outbound-rules "protocol:icmp,address:0.0.0.0/0,address:::/0 protocol:tcp,ports:all,address:0.0.0.0/0,address:::/0 protocol:udp,ports:all,address:0.0.0.0/0,address:::/0"

# # try this (038ccf60-c31d-40ed-83b3-0201b22d1227)
# doctl compute firewall update 038ccf60-c31d-40ed-83b3-0201b22d1227 \
#   --name marvel-swarm-rules \
#   --tag-names 'cluster:swarm-marvel' \
#   --inbound-rules 'protocol:tcp,ports:22,address:192.147.118.253/32 protocol:tcp,ports:22,address:196.52.34.22/32 protocol:tcp,ports:22,address:69.203.219.29/32 protocol:tcp,ports:22,address:69.203.219.29/32' \
#   --outbound-rules "protocol:icmp,address:0.0.0.0/0,address:::/0 protocol:tcp,ports:all,address:0.0.0.0/0,address:::/0 protocol:udp,ports:all,address:0.0.0.0/0,address:::/0"


# # AUTOSET SECURITY GROUPS BASED ON PRIVATE IPS:
#  |2.2.3|  using virtualenv: docker-swarm-marvel2  hyenatop in ~/dev/bossjones/docker-swarm-marvel
# ± |master U:1 ?:9 ✗| → doctl compute droplet list |grep 'stark-tower\|baxter\|latveria'| awk '{print $4}'
# 10.132.41.67
# 10.132.52.233
# 10.132.56.13

# 1024-65535

# # Final security groups
# doctl compute firewall update 038ccf60-c31d-40ed-83b3-0201b22d1227 \
#   --name marvel-swarm-rules \
#   --tag-names 'cluster:swarm-marvel' \
#   --inbound-rules 'protocol:tcp,ports:22,address:192.147.118.253/32 protocol:tcp,ports:22,address:196.52.34.22/32 protocol:tcp,ports:1-65535,address:69.203.219.29/32 protocol:tcp,ports:22,address:69.203.219.29/32 protocol:tcp,ports:1024-65535,address:10.132.41.67/32 protocol:tcp,ports:1024-65535,address:10.132.52.233/32 protocol:tcp,ports:1024-65535,address:10.132.56.13/32' \
#   --outbound-rules "protocol:icmp,address:0.0.0.0/0,address:::/0 protocol:tcp,ports:all,address:0.0.0.0/0,address:::/0 protocol:udp,ports:all,address:0.0.0.0/0,address:::/0"




# # result:
# #  |2.2.3|  using virtualenv: docker-swarm-marvel2  hyenatop in ~/dev/bossjones/docker-swarm-marvel
# # ± |master U:1 ?:8 ✗| → doctl compute firewall create \
# # >   --name marvel-swarm-rules \
# # >   --tag-names 'cluster:swarm-marvel' \
# # >   --inbound-rules "protocol:tcp,ports:22,address:192.147.118.253/32"
# # ID                                      Name                  Status     Created At              Inbound Rules                                       Outbound Rules    Droplet IDs Tags                    Pending Changes
# # 038ccf60-c31d-40ed-83b3-0201b22d1227    marvel-swarm-rules    waiting    2017-10-17T23:35:31Z    protocol:tcp,ports:22,address:192.147.118.253/32 cluster:swarm-marvel    droplet_id:66766275,removing:false,status:waiting droplet_id:66766364,removing:false,status:waiting droplet_id:66766499,removing:false,status:waiting

# #  |2.2.3|  using virtualenv: docker-swarm-marvel2  hyenatop in ~/dev/bossjones/docker-swarm-marvel
# # ± |master U:1 ?:8 ✗| →
#    \
# #   --outbound-rules protocol:icmp,ports:all,address:0.0.0.0/0 protocol:tcp,ports:all,address:0.0.0.0/0 protocol:udp,ports:all,address:0.0.0.0/0

# # protocol:tcp,ports:22,address:196.52.34.22/32 protocol:tcp,ports:22,address:69.203.219.29/32" --outbound-rules protocol:icmp,ports:all,address:0.0.0.0/0,address:::/0 protocol:tcp,ports:all,address:0.0.0.0/0,address:::/0 protocol:udp,ports:all,address:0.0.0.0/0,address:::/0

# 27133      id_rsa.pub         f2:04:dd:b6:2d:52:e1:32:61:5f:04:79:f9:bf:2c:fe
# 27134      id_rsa_rs.pub      c0:e5:5b:02:1c:e5:28:e8:39:b4:7d:68:29:3d:96:0c
# 27135      id_rsa_ssh.pub     2f:7d:20:ac:e1:6e:ce:37:e6:7f:e4:2e:1e:9f:fa:78
# 972901     myohackteam.pub    e5:af:87:51:5c:3f:93:62:3a:d6:2d:37:8e:e3:8a:f4
# 4194108    mr robot           22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75

# f2:04:dd:b6:2d:52:e1:32:61:5f:04:79:f9:bf:2c:fe,c0:e5:5b:02:1c:e5:28:e8:39:b4:7d:68:29:3d:96:0c,2f:7d:20:ac:e1:6e:ce:37:e6:7f:e4:2e:1e:9f:fa:78,e5:af:87:51:5c:3f:93:62:3a:d6:2d:37:8e:e3:8a:f4,22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75

# ID          Name                   Public IPv4       Private IPv4      Public IPv6    Memory    VCPUs    Disk    Region    Image                 Status    Tags
# 4320917     scarlettnet.dark.io    104.131.222.84    10.128.126.239                   1024      1        20      nyc2      CentOS 7 x64          off
# 54418445    scarlett-travis        159.203.94.92                                      8192      4        80      nyc3      Ubuntu 14.04.5 x64    active
# 66827870    stark-tower            165.227.108.16                                     8192      4        80      nyc3      Ubuntu 14.04.5 x64    active
# 66827928    baxter                 138.197.72.255                                     2048      2        40      nyc3      Ubuntu 14.04.5 x64    active
# 66827975    latveria               165.227.110.4                                      1024      1        30      nyc3      Ubuntu 14.04.5 x64    active

# doctl compute droplet create stark-tower \
#   --size "8gb" \
#   --image "fedora-24-x64" \
#   --region nyc3 \
#   --ssh-keys f2:04:dd:b6:2d:52:e1:32:61:5f:04:79:f9:bf:2c:fe,c0:e5:5b:02:1c:e5:28:e8:39:b4:7d:68:29:3d:96:0c,2f:7d:20:ac:e1:6e:ce:37:e6:7f:e4:2e:1e:9f:fa:78,e5:af:87:51:5c:3f:93:62:3a:d6:2d:37:8e:e3:8a:f4,22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75 \
#   --wait

# doctl compute droplet create baxter \
#   --size "2gb" \
#   --image "fedora-24-x64" \
#   --region nyc3 \
#   --ssh-keys f2:04:dd:b6:2d:52:e1:32:61:5f:04:79:f9:bf:2c:fe,c0:e5:5b:02:1c:e5:28:e8:39:b4:7d:68:29:3d:96:0c,2f:7d:20:ac:e1:6e:ce:37:e6:7f:e4:2e:1e:9f:fa:78,e5:af:87:51:5c:3f:93:62:3a:d6:2d:37:8e:e3:8a:f4,22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75 \
#   --wait

# doctl compute droplet create latveria \
#   --size "1gb" \
#   --image "fedora-24-x64" \
#   --region nyc3 \
#   --ssh-keys f2:04:dd:b6:2d:52:e1:32:61:5f:04:79:f9:bf:2c:fe,c0:e5:5b:02:1c:e5:28:e8:39:b4:7d:68:29:3d:96:0c,2f:7d:20:ac:e1:6e:ce:37:e6:7f:e4:2e:1e:9f:fa:78,e5:af:87:51:5c:3f:93:62:3a:d6:2d:37:8e:e3:8a:f4,22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75 \
#   --wait



# #  |2.2.3|  using virtualenv: docker-swarm-marvel2  hyenatop in ~/dev/bossjones/docker-swarm-marvel
# # ± |master U:1 ?:8 ✗| → doctl compute droplet create stark-tower \
# # >   --size "8gb" \
# # >   --image "fedora-24-x64" \
# # >   --region nyc3 \
# # >   --ssh-keys 22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75 \
# # >   --wait \
# # >   --enable-private-networking
# # ID          Name           Public IPv4       Private IPv4    Public IPv6    Memory    VCPUs    Disk    Region    Image                 Status    Tags
# # 66766275    stark-tower    174.138.55.185    10.132.41.67                   8192      4        80      nyc3      Ubuntu 14.04.5 x64    active

# #  |2.2.3|  using virtualenv: docker-swarm-marvel2  hyenatop in ~/dev/bossjones/docker-swarm-marvel
# # ± |master U:1 ?:8 ✗| → doctl compute droplet create baxter \
# # >   --size "2gb" \
# # >   --image "fedora-24-x64" \
# # >   --region nyc3 \
# # >   --ssh-keys 22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75 \
# # >   --wait \
# # >   --enable-private-networking
# # ID          Name      Public IPv4        Private IPv4     Public IPv6    Memory    VCPUs    Disk    Region    Image                 Status    Tags
# # 66766364    baxter    159.203.162.146    10.132.52.233                   2048      2        40      nyc3      Ubuntu 14.04.5 x64    active

# #  |2.2.3|  using virtualenv: docker-swarm-marvel2  hyenatop in ~/dev/bossjones/docker-swarm-marvel
# # ± |master U:1 ?:8 ✗| → doctl compute droplet create latveria \
# # >   --size "1gb" \
# # >   --image "fedora-24-x64" \
# # >   --region nyc3 \
# # >   --ssh-keys 22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75 \
# # >   --wait \
# # >   --enable-private-networking
# # ID          Name        Public IPv4       Private IPv4    Public IPv6    Memory    VCPUs    Disk    Region    Image                 Status    Tags
# # 66766499    latveria    159.203.122.47    10.132.56.13                   1024      1        30      nyc3      Ubuntu 14.04.5 x64    active

# #  |2.2.3|  using virtualenv: docker-swarm-marvel2  hyenatop in ~/dev/bossjones/docker-swarm-marvel
# # ± |master U:1 ?:8 ✗| →


# doctl compute droplet create necropolis \
#   --size "8gb" \
#   --image "fedora-24-x64" \
#   --region nyc3 \
#   --ssh-keys 22:ec:92:a0:77:1d:28:c0:12:9b:d7:b0:a5:79:a3:75 \
#   --wait \
#   --enable-private-networking

#  |2.2.3|  using virtualenv: docker-swarm-marvel2  hyenatop in ~/dev/bossjones/docker-swarm-marvel
# ± |master U:1 ?:6 ✗| → doctl compute firewall list
# ID                                      Name             Status       Created At              Inbound Rules                                                                                                                                    Outbound Rules                                                                                                                                                  Droplet IDs    Tags    Pending Changes
# 53839e97-1d1e-48c7-9939-05320ba7e165    ssh-hyena-apt    succeeded    2017-07-08T15:19:52Z    protocol:tcp,ports:22,address:192.147.118.253/32 protocol:tcp,ports:22,address:196.52.34.22/32 protocol:tcp,ports:22,address:69.203.219.29/32    protocol:icmp,ports:0,address:0.0.0.0/0,address:::/0 protocol:tcp,ports:0,address:0.0.0.0/0,address:::/0 protocol:udp,ports:0,address:0.0.0.0/0,address:::/0    54418445
